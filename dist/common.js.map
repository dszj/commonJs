{"version":3,"file":"common.js","sources":["../src/ua.js","../src/para.js","../src/jsload.js","../src/cookie.js","../src/storage.js","../src/qrcode.js","../src/vconsole.js","../src/main.js","../src/BGMAutoPlayMgr.js"],"sourcesContent":["let c = navigator.userAgent;\r\nlet d = navigator.userAgent.toLowerCase();\r\nlet e = d.match(/MicroMessenger/i) == \"micromessenger\";\r\nlet b = e || (!!c.match(/(iPhone|iPod|Android|ios|Mobile)/i));\r\nexport default {\r\n    mobile: b,\r\n    pc: !b,\r\n    ios: !!c.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),\r\n    android: c.indexOf(\"Android\") > -1,\r\n    weixin: e,\r\n    weibo: c.indexOf(\"weibo\") > -1,\r\n    isTest : window.location.href.search(/localhost|192\\.|127\\.|10\\./) > -1,\r\n}\r\n","let getPara = function(e) {\r\n    var d = location.search;\r\n    var c = new RegExp(\"[&|?]\" + e + \"=([^&$]*)\",\"gi\");\r\n    var b = c.test(d);\r\n    return b ? RegExp.$1 : \"\"\r\n}\r\nlet setPara = function(arg,arg_val,url){ \r\n    var pattern=arg+'=([^&]*)'; \r\n    var replaceText=arg+'='+arg_val; \r\n    var url = !!url ? url : location.href.toString();\r\n    if(url.match(pattern)){ \r\n        // var tmp='/('+ arg+'=)([^&]*)/gi'; \r\n        // tmp=url.replace(eval(tmp),replaceText); \r\n        var tmp='('+ arg+'=)([^&]*)';\r\n        tmp=url.replace(new RegExp(tmp,'gi'),replaceText); \r\n        return tmp; \r\n    }else{ \r\n        if(url.substring(url.length-1) == \"#\")url=url.substring(0,url.length-1);\r\n        if(url.match('[\\?]')){ \r\n            return url+'&'+replaceText; \r\n        }else{ \r\n            return url+'?'+replaceText; \r\n        } \r\n    } \r\n    return url+'\\n'+arg+'\\n'+arg_val; \r\n} \r\n\r\n\r\nexport default {\r\n    getPara , setPara\r\n};","export default function(b, j) {\r\n    var d = b;\r\n    var c = [];\r\n    var g = function(i, l) {\r\n        if (!f(c, i)) {\r\n            var k = document.createElement(\"script\");\r\n            k.type = \"text/javascript\";\r\n            k.src = i;\r\n            l = l || function() {};\r\n            k.onload = k.onreadystatechange = function() {\r\n                if (!this.readyState || \"loaded\" === this.readyState || \"complete\" === this.readyState) {\r\n                    l();\r\n                    c.push(i)\r\n                }\r\n            };\r\n            document.body.appendChild(k)\r\n        } else {\r\n            l()\r\n        }\r\n    };\r\n    var f = function(l, n) {\r\n        if (l != null && l.length > 0) {\r\n            var k = l.length;\r\n            for (var m = 0; m < k; m++) {\r\n                if (l[m] == n) {\r\n                    return true\r\n                }\r\n            }\r\n        }\r\n        return false\r\n    };\r\n    if (d.length > 0) {\r\n        var h = 0;\r\n        for (var e = 0; e < d.length; e++) {\r\n            g(d[e], function() {\r\n                h++;\r\n                if (h == d.length) {\r\n                    if (typeof j == \"function\") {\r\n                        j()\r\n                    }\r\n                }\r\n            })\r\n        }\r\n    }\r\n}","/* eslint-disable no-var */\nfunction assign (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        target[key] = source[key];\n      }\n    }\n    return target\n  }\n  /* eslint-enable no-var */\n\n  /* eslint-disable no-var */\n  var defaultConverter = {\n    read: function (value) {\n      if (value[0] === '\"') {\n        value = value.slice(1, -1);\n      }\n      return value.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent)\n    },\n    write: function (value) {\n      return encodeURIComponent(value).replace(\n        /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,\n        decodeURIComponent\n      )\n    }\n  };\n  /* eslint-enable no-var */\n\n  /* eslint-disable no-var */\n\n  function init (converter, defaultAttributes) {\n    function set (key, value, attributes) {\n      if (typeof document === 'undefined') {\n        return\n      }\n\n      attributes = assign({}, defaultAttributes, attributes);\n\n      if (typeof attributes.expires === 'number') {\n        attributes.expires = new Date(Date.now() + attributes.expires * 864e5);\n      }\n      if (attributes.expires) {\n        attributes.expires = attributes.expires.toUTCString();\n      }\n\n      key = encodeURIComponent(key)\n        .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n        .replace(/[()]/g, escape);\n\n      var stringifiedAttributes = '';\n      for (var attributeName in attributes) {\n        if (!attributes[attributeName]) {\n          continue\n        }\n\n        stringifiedAttributes += '; ' + attributeName;\n\n        if (attributes[attributeName] === true) {\n          continue\n        }\n\n        // Considers RFC 6265 section 5.2:\n        // ...\n        // 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n        //     character:\n        // Consume the characters of the unparsed-attributes up to,\n        // not including, the first %x3B (\";\") character.\n        // ...\n        stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n      }\n\n      return (document.cookie =\n        key + '=' + converter.write(value, key) + stringifiedAttributes)\n    }\n\n    function get (key) {\n      if (typeof document === 'undefined' || (arguments.length && !key)) {\n        return\n      }\n\n      // To prevent the for loop in the first place assign an empty array\n      // in case there are no cookies at all.\n      var cookies = document.cookie ? document.cookie.split('; ') : [];\n      var jar = {};\n      for (var i = 0; i < cookies.length; i++) {\n        var parts = cookies[i].split('=');\n        var value = parts.slice(1).join('=');\n\n        try {\n          var foundKey = decodeURIComponent(parts[0]);\n          jar[foundKey] = converter.read(value, foundKey);\n\n          if (key === foundKey) {\n            break\n          }\n        } catch (e) {}\n      }\n\n      return key ? jar[key] : jar\n    }\n\n    return Object.create(\n      {\n        set: set,\n        get: get,\n        remove: function (key, attributes) {\n          set(\n            key,\n            '',\n            assign({}, attributes, {\n              expires: -1\n            })\n          );\n        },\n        withAttributes: function (attributes) {\n          return init(this.converter, assign({}, this.attributes, attributes))\n        },\n        withConverter: function (converter) {\n          return init(assign({}, this.converter, converter), this.attributes)\n        }\n      },\n      {\n        attributes: { value: Object.freeze(defaultAttributes) },\n        converter: { value: Object.freeze(converter) }\n      }\n    )\n  }\n\n  var api = init(defaultConverter, { path: '/' });\n//   /* eslint-enable no-var */\n\n//   return api;\n\n//https://github.com/js-cookie/js-cookie\nexport default api;","let setStorage = function(k,v) {\r\n    let tem = {\r\n        value:v,\r\n        time:new Date().getTime()\r\n    }\r\n    tem = JSON.stringify(tem);\r\n    localStorage.setItem(k,tem);\r\n}\r\nlet getStorage = function(k,time){ \r\n    let tem = localStorage.getItem(k);\r\n    if(!tem){return ''}\r\n    tem = JSON.parse(tem);\r\n    if(!time){\r\n        time = new Date().getTime();\r\n    }\r\n    if(new Date().getTime() - tem.time > time){\r\n        return ''\r\n    }\r\n    return tem.value;\r\n} \r\n\r\n\r\nexport default {\r\n    setStorage , getStorage\r\n};","export default function(){\r\n    console.log(location.href)\r\n    // console.log('http://tool.oschina.net/action/qrcode/generate?data=' + encodeURIComponent(location.href) + '&output=image%2Fgif&error=L&type=0&margin=4&size=4')\r\n    // console.log(\"%c aaa\", \"opacity:.6;display:block;padding:50px;background:url('http://tool.oschina.net/action/qrcode/generate?data=\" + encodeURIComponent(location.href) + \"&output=image%2Fgif&error=L&type=0&margin=4&size=4') no-repeat;background-size:contain;\");\r\n};","import ua from './ua.js';\r\nimport para from './para.js';\r\nimport jsLoad from './jsload.js';\r\n\r\nexport default function(){\r\n    const c = ua;\r\n    const d = ua.isTest;\r\n    const e = !(navigator.platform.indexOf(\"Win\") === 0 || navigator.platform.indexOf(\"Mac\") === 0);\r\n    if (!e) {\r\n        // return\r\n    }\r\n    const b = para.getPara(\"vconsole\");\r\n    if ((c.mobile && d && b !== \"false\") || b === \"true\") {\r\n        jsLoad([\"https://cdn.jsdelivr.net/npm/vconsole@3.15.1/dist/vconsole.min.js\"], function() {\r\n            var f = new VConsole()\r\n        })\r\n    }\r\n}","import { version } from '../package.json';\r\nimport qrcode from './qrcode.js';\r\nimport ua from './ua.js';\r\nimport para from './para.js';\r\nimport jsLoad from './jsload.js';\r\nimport vconsole from './vconsole.js';\r\nimport cookie from './cookie.js';\r\nimport storage from './storage.js';\r\nimport BGMAutoPlayMgr from './BGMAutoPlayMgr';\r\n\r\n//控制台二维码\r\nqrcode();\r\nvconsole();\r\nexport default {\r\n    v : version,\r\n    version : version,\r\n    ua : ua,\r\n    getPara : para.getPara , \r\n    setPara : para.setPara,\r\n    getStorage : storage.getStorage , \r\n    setStorage : storage.setStorage,\r\n    jsLoad : jsLoad,\r\n    cookie : cookie,\r\n    BGMAutoPlayMgr : BGMAutoPlayMgr\r\n}","/**\n * @author ccbbs\n * @file 解决安卓webview自动播放背景音乐的问题\n */\nexport default function BGMAutoPlayMgr/* solveAndroidBGMAutoplay */(url) {\n    this.audioContext = new (window.AudioContext || window.webkitAudioContext || window.mozAudioContext)();\n    this.sourceNode = null;\n    this.buffer = null;\n    this.isPlayingBGM = false;\n    this.toggleBGM = function () {\n        if (typeof this.sourceNode == 'object') {\n            if (this.isPlayingBGM) {\n                this.sourceNode.stop();\n                this.isPlayingBGM = false;\n            } else this._playSourceNode();\n        }\n    }\n    this._playSourceNode = function () {\n        const audioContext = this.audioContext;\n        audioContext.resume();\n        const _sourceNode = audioContext.createBufferSource();\n        _sourceNode.buffer = this.buffer;\n        _sourceNode.loop = true;\n        _sourceNode.connect(audioContext.destination);\n        _sourceNode.start(0);\n        this.sourceNode = _sourceNode;\n        this.isPlayingBGM = true;\n    }\n    let loadAndAutoPlay = (audioUrl) => {\n        const audioContext = this.audioContext;\n        const xhr = new XMLHttpRequest();\n        xhr.open('GET', audioUrl, true);\n        xhr.responseType = 'arraybuffer';\n        xhr.onreadystatechange = () => {\n            if (xhr.status < 400 && xhr.status >= 200 && xhr.readyState === 4) {\n                audioContext.decodeAudioData(xhr.response, buffer => {\n                    this.buffer = buffer;\n                    if(typeof WeixinJSBridge != 'undefined'){\n                        WeixinJSBridge.invoke(\"getNetworkType\", {}, () => this._playSourceNode());\n                    }else{\n                        this._playSourceNode()\n                    }\n                });\n            }\n        }\n        xhr.send();\n    }\n    loadAndAutoPlay(url);\n    loadAndAutoPlay = null;\n}\n/* \n使用示例\nconst bgm = new BGMAutoPlayMgr('http://192.168.1.1:8080/bgm.mp3');\nfunction toggleBGM() {\n    bgm.toggleBGM();\n} \n*/"],"names":["c","navigator","userAgent","d","toLowerCase","e","match","b","mobile","pc","ios","android","indexOf","weixin","weibo","isTest","window","location","href","search","getPara","RegExp","test","$1","setPara","arg","arg_val","url","replaceText","replace","substring","length","j","h","i","l","k","n","m","f","document","createElement","type","src","onload","onreadystatechange","this","readyState","push","body","appendChild","g","assign","target","arguments","key","source","api","init","converter","defaultAttributes","set","value","attributes","expires","Date","now","toUTCString","encodeURIComponent","decodeURIComponent","escape","attributeName","stringifiedAttributes","split","cookie","write","Object","create","get","cookies","jar","parts","slice","join","foundKey","read","remove","withAttributes","withConverter","freeze","path","setStorage","v","tem","time","getTime","JSON","stringify","localStorage","setItem","getStorage","getItem","parse","console","log","ua","platform","para","jsLoad","VConsole","vconsole","version","storage","BGMAutoPlayMgr","audioContext","AudioContext","webkitAudioContext","mozAudioContext","sourceNode","buffer","isPlayingBGM","toggleBGM","stop","_playSourceNode","resume","_sourceNode","createBufferSource","loop","connect","destination","start","audioUrl","xhr","XMLHttpRequest","open","responseType","status","decodeAudioData","response","WeixinJSBridge","invoke","send","loadAndAutoPlay"],"mappings":"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"}